<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿå›¾åƒç”Ÿæˆæµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold text-center mb-6 text-red-600">ğŸš¨ å¿«é€Ÿå›¾åƒç”Ÿæˆé—®é¢˜è¯Šæ–­</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">æµ‹è¯•æç¤ºè¯</h2>
            <div class="space-y-4">
                <input type="text" id="prompt" placeholder="è¾“å…¥å›¾åƒç”Ÿæˆæç¤ºè¯"
                       class="w-full p-3 border rounded"
                       value="ç”Ÿæˆä¸€åªå¯çˆ±çš„å°çŒ«ï¼ŒçœŸå®ç…§ç‰‡é£æ ¼">
                <div class="flex gap-2">
                    <button onclick="testChinese()" class="bg-red-500 text-white px-4 py-2 rounded">æµ‹è¯•ä¸­æ–‡</button>
                    <button onclick="testEnglish()" class="bg-blue-500 text-white px-4 py-2 rounded">æµ‹è¯•è‹±æ–‡</button>
                    <button onclick="testExplicit()" class="bg-green-500 text-white px-4 py-2 rounded">æµ‹è¯•æ˜¾å¼</button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">å®æ—¶æ—¥å¿—</h2>
            <div id="log" class="p-4 bg-black text-green-400 rounded font-mono text-sm max-h-64 overflow-auto">
                ç­‰å¾…æµ‹è¯•...
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-lg font-semibold mb-4">å›¾åƒæ˜¾ç¤º</h2>
            <div id="images" class="min-h-32 border rounded p-4">
                <span class="text-gray-500">å›¾åƒå°†åœ¨è¿™é‡Œæ˜¾ç¤º</span>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "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";
        const MODEL = "google/gemini-2.5-flash-image-preview";

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function testChinese() {
            testPrompt('ç”Ÿæˆä¸€åªå¯çˆ±çš„å°çŒ«ï¼ŒçœŸå®ç…§ç‰‡é£æ ¼', 'ä¸­æ–‡');
        }

        function testEnglish() {
            testPrompt('create a cute cat, photorealistic style', 'è‹±æ–‡');
        }

        function testExplicit() {
            testPrompt('generate image: a cute cat, photorealistic style', 'æ˜¾å¼è‹±æ–‡');
        }

        async function testPrompt(prompt, type) {
            log(`ğŸš€ å¼€å§‹æµ‹è¯•${type}æç¤ºè¯: "${prompt}"`);

            try {
                log('ğŸ“¤ å‘é€APIè¯·æ±‚...');

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Quick Image Test'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                log(`ğŸ“Š HTTPçŠ¶æ€: ${response.status}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                log('ğŸ“¥ æ”¶åˆ°APIå“åº”');

                // æ£€æŸ¥å“åº”ç»“æ„
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('å“åº”æ ¼å¼æ— æ•ˆ');
                }

                const message = data.choices[0].message;
                log(`ğŸ’¬ AIå›å¤: "${message.content}"`);

                // æ£€æŸ¥å›¾åƒæ•°æ®
                if (message.images && message.images.length > 0) {
                    log(`ğŸ–¼ï¸  å‘ç° ${message.images.length} å¼ å›¾åƒ`);

                    message.images.forEach((image, index) => {
                        log(`ğŸ–¼ï¸  å›¾åƒ ${index + 1} ç»“æ„: ${JSON.stringify(image, null, 2)}`);

                        if (image.image_url && image.image_url.url) {
                            log(`ğŸ”— å›¾åƒ ${index + 1} URL: ${image.image_url.url.substring(0, 100)}...`);
                        } else {
                            log(`âŒ å›¾åƒ ${index + 1} ç¼ºå°‘URL`);
                        }
                    });

                    displayImages(message.images);
                } else {
                    log('âŒ å“åº”ä¸­æ²¡æœ‰å›¾åƒæ•°æ®');
                    log('ğŸ“‹ å®Œæ•´å“åº”ç»“æ„:');
                    log(JSON.stringify(data, null, 2));
                }

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
            }
        }

        function displayImages(images) {
            const imagesDiv = document.getElementById('images');
            let html = '';

            images.forEach((image, index) => {
                if (image.image_url && image.image_url.url) {
                    html += `
                        <div class="border rounded p-4 mb-4">
                            <img src="${image.image_url.url}"
                                 alt="ç”Ÿæˆçš„å›¾åƒ ${index + 1}"
                                 class="max-w-full h-auto rounded"
                                 onload="log('âœ… å›¾åƒ ${index + 1} åŠ è½½æˆåŠŸ')"
                                 onerror="log('âŒ å›¾åƒ ${index + 1} åŠ è½½å¤±è´¥ - URLå¯èƒ½æ— æ•ˆ')">
                            <p class="text-sm text-gray-600 mt-2">å›¾åƒ ${index + 1}</p>
                            <p class="text-xs text-gray-500">URL: ${image.image_url.url.substring(0, 50)}...</p>
                        </div>
                    `;
                }
            });

            imagesDiv.innerHTML = html || '<p class="text-red-500">æ²¡æœ‰å›¾åƒå¯æ˜¾ç¤º</p>';
        }
    </script>
</body>
</html>