<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ Nano Banana å›¾åƒç”Ÿæˆæµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-yellow-600">ğŸŒ Nano Banana å›¾åƒç”Ÿæˆæµ‹è¯•</h1>

        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-semibold text-yellow-800 mb-2">ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
            <p class="text-yellow-700">
                è¿™ä¸ªæµ‹è¯•å·¥å…·ä¸“é—¨ç”¨äºéªŒè¯ <strong>Google Nano Banana (Gemini 2.5 Flash Image)</strong> æ¨¡å‹çš„å›¾åƒç”ŸæˆåŠŸèƒ½ã€‚
                è¯¥æ¨¡å‹æ”¯æŒæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆã€å›¾åƒç¼–è¾‘å’Œå¤šè½®å¯¹è¯ä¸­çš„å›¾åƒç”Ÿæˆã€‚
            </p>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ”§ æµ‹è¯•é…ç½®</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">APIå¯†é’¥:</label>
                    <input type="text" id="api-key" value="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"
                           class="w-full p-3 border rounded font-mono text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Nano Bananaæ¨¡å‹ID:</label>
                    <input type="text" id="model-id" value="google/gemini-2.5-flash-preview-image"
                           class="w-full p-3 border rounded font-mono text-sm bg-gray-100" readonly>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ¯ æµ‹è¯•æç¤ºè¯</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">è‡ªå®šä¹‰æç¤ºè¯:</label>
                    <input type="text" id="custom-prompt" placeholder="æè¿°æ‚¨æƒ³è¦ç”Ÿæˆçš„å›¾åƒ"
                           class="w-full p-3 border rounded">
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <button onclick="testPrompt('ä¸€åªå¯çˆ±çš„å°çŒ«ï¼ŒçœŸå®ç…§ç‰‡é£æ ¼')"
                            class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">å¯çˆ±å°çŒ«</button>
                    <button onclick="testPrompt('generate image: a cute cat, photorealistic style')"
                            class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">Cute Cat</button>
                    <button onclick="testPrompt('ç”Ÿæˆå›¾åƒï¼šæœªæ¥åŸå¸‚çš„æ—¥è½æ™¯è±¡ï¼Œèµ›åšæœ‹å…‹é£æ ¼')"
                            class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">æœªæ¥åŸå¸‚</button>
                    <button onclick="testPrompt('create an image: a peaceful mountain landscape at sunrise')"
                            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Mountain Sunrise</button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š å®æ—¶æ—¥å¿—</h2>
            <div id="log" class="p-4 bg-black text-green-400 rounded font-mono text-sm max-h-64 overflow-auto">
                ç­‰å¾…æµ‹è¯•Nano Banana...
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ–¼ï¸ å›¾åƒæ˜¾ç¤º</h2>
            <div id="images" class="min-h-32 border rounded p-4 flex items-center justify-center">
                <span class="text-gray-500">Nano Bananaç”Ÿæˆçš„å›¾åƒå°†åœ¨è¿™é‡Œæ˜¾ç¤º</span>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = document.getElementById('api-key').value;
        const MODEL_ID = document.getElementById('model-id').value;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function testPrompt(promptText) {
            document.getElementById('custom-prompt').value = promptText;
            testNanoBanana();
        }

        async function testNanoBanana() {
            const prompt = document.getElementById('custom-prompt').value;

            if (!prompt) {
                alert('è¯·è¾“å…¥æç¤ºè¯');
                return;
            }

            log(`ğŸš€ å¼€å§‹æµ‹è¯•Nano Bananaå›¾åƒç”Ÿæˆ`);
            log(`ğŸ“ æç¤ºè¯: "${prompt}"`);
            log(`ğŸ¤– æ¨¡å‹: ${MODEL_ID}`);

            try {
                log('ğŸ“¡ è¿æ¥åˆ°OpenRouter API...');

                // ğŸ” ä½¿ç”¨æ­£ç¡®çš„Nano Bananaæ ¼å¼ - æ ¹æ®Googleæ–‡æ¡£
                const requestBody = {
                    model: MODEL_ID,
                    messages: [
                        {
                            role: 'user',
                            content: [
                                {
                                    type: 'text',
                                    text: prompt
                                }
                            ]
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 1000,
                    // æ·»åŠ å›¾åƒç”Ÿæˆå‚æ•°
                    modalities: ["text", "image"],
                    response_format: { type: "text" }
                };

                log('ğŸ“‹ è¯·æ±‚ä½“: ' + JSON.stringify(requestBody, null, 2));

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Nano Banana Test'
                    },
                    body: JSON.stringify(requestBody)
                });

                log(`ğŸ“Š HTTPçŠ¶æ€: ${response.status}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                log('ğŸ“¥ æ”¶åˆ°APIå“åº”');

                // ğŸ” è¯¦ç»†åˆ†æå“åº”ç»“æ„
                log('ğŸ” åˆ†æå“åº”ç»“æ„...');
                log('ğŸ“‹ å®Œæ•´å“åº”: ' + JSON.stringify(data, null, 2));

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('å“åº”æ ¼å¼æ— æ•ˆï¼šç¼ºå°‘messageå­—æ®µ');
                }

                const message = data.choices[0].message;
                log(`ğŸ’¬ AIå›å¤: "${message.content}"`);

                // ğŸ” æ£€æŸ¥å›¾åƒæ•°æ®
                log(`ğŸ” æ£€æŸ¥å›¾åƒæ•°æ®...`);
                log(`ğŸ“Š æ˜¯å¦æœ‰imageså­—æ®µ: ${message.images ? 'æ˜¯' : 'å¦'}`);

                if (message.images && message.images.length > 0) {
                    log(`ğŸ‰ å‘ç° ${message.images.length} å¼ å›¾åƒï¼`);

                    message.images.forEach((image, index) => {
                        log(`ğŸ–¼ï¸  å›¾åƒ ${index + 1} è¯¦æƒ…:`);
                        log(`   ç±»å‹: ${image.type}`);
                        log(`   æ˜¯å¦æœ‰image_url: ${image.image_url ? 'æ˜¯' : 'å¦'}`);

                        if (image.image_url && image.image_url.url) {
                            log(`   URLé•¿åº¦: ${image.image_url.url.length} å­—ç¬¦`);
                            log(`   URLé¢„è§ˆ: ${image.image_url.url.substring(0, 100)}...`);
                        }
                    });

                    displayImages(message.images);
                } else {
                    log('âŒ å“åº”ä¸­æ²¡æœ‰å›¾åƒæ•°æ®');
                    log('ğŸ’¡ å¯èƒ½çš„åŸå› :');
                    log('   1. æ¨¡å‹ä¸æ”¯æŒå›¾åƒç”Ÿæˆ');
                    log('   2. æç¤ºè¯æ²¡æœ‰è§¦å‘å›¾åƒç”ŸæˆåŠŸèƒ½');
                    log('   3. APIå¯†é’¥æƒé™ä¸è¶³');
                    log('   4. éœ€è¦ç‰¹å®šçš„æç¤ºè¯æ ¼å¼');

                    // æ˜¾ç¤ºå®Œæ•´å“åº”ä»¥ä¾›åˆ†æ
                    log('ğŸ“Š å®Œæ•´å“åº”ç»“æ„åˆ†æ:');
                    analyzeResponseStructure(data);
                }

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
                document.getElementById('images').innerHTML = `
                    <div class="text-red-500">
                        <p class="font-semibold">é”™è¯¯: ${error.message}</p>
                        <p class="text-sm mt-2">è¯·æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥</p>
                    </div>
                `;
            }
        }

        function analyzeResponseStructure(data) {
            log('ğŸ”¬ è¯¦ç»†å“åº”ç»“æ„åˆ†æ:');

            try {
                // æ£€æŸ¥å“åº”çš„æ¯ä¸ªéƒ¨åˆ†
                log(`ğŸ“ å“åº”é”®: ${Object.keys(data).join(', ')}`);

                if (data.choices) {
                    log(`ğŸ“ choicesæ•°é‡: ${data.choices.length}`);

                    data.choices.forEach((choice, index) => {
                        log(`ğŸ“ choice[${index}] é”®: ${Object.keys(choice).join(', ')}`);

                        if (choice.message) {
                            log(`ğŸ“ message é”®: ${Object.keys(choice.message).join(', ')}`);

                            if (choice.message.content) {
                                log(`ğŸ“ å†…å®¹é•¿åº¦: ${choice.message.content.length}`);
                            }

                            if (choice.message.images) {
                                log(`ğŸ“ å›¾åƒæ•°é‡: ${choice.message.images.length}`);
                            } else {
                                log('ğŸ“ æ— imageså­—æ®µ');
                            }
                        }
                    });
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
                if (data.error) {
                    log(`ğŸš¨ APIé”™è¯¯: ${JSON.stringify(data.error)}`);
                }

                // æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
                if (data.usage) {
                    log(`ğŸ“ˆ ä½¿ç”¨ç»Ÿè®¡: ${JSON.stringify(data.usage)}`);
                }

            } catch (e) {
                log(`ğŸ” åˆ†æé”™è¯¯: ${e.message}`);
            }
        }

        function displayImages(images) {
            const imagesDiv = document.getElementById('images');
            let html = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <h3 class="md:col-span-2 text-lg font-semibold text-green-600 mb-4">âœ… Nano BananaæˆåŠŸç”Ÿæˆå›¾åƒï¼</h3>
            `;

            images.forEach((image, index) => {
                if (image.image_url && image.image_url.url) {
                    html += `
                        <div class="border rounded-lg p-4">
                            <img src="${image.image_url.url}"
                                 alt="Nano Bananaç”Ÿæˆçš„å›¾åƒ ${index + 1}"
                                 class="max-w-full h-auto rounded cursor-pointer hover:opacity-80"
                                 onclick="window.open('${image.image_url.url}', '_blank')"
                                 onload="log('âœ… å›¾åƒ ${index + 1} åŠ è½½æˆåŠŸ')"
                                 onerror="log('âŒ å›¾åƒ ${index + 1} åŠ è½½å¤±è´¥')">
                            <p class="text-sm text-gray-600 mt-2">å›¾åƒ ${index + 1}</p>
                            <p class="text-xs text-gray-500 mt-1">URL: ${image.image_url.url.substring(0, 50)}...</p>
                        </div>
                    `;
                }
            });

            html += '</div>';
            imagesDiv.innerHTML = html;

            log('ğŸ‰ å›¾åƒæ˜¾ç¤ºå®Œæˆï¼ç‚¹å‡»å›¾åƒå¯æŸ¥çœ‹å®Œæ•´å°ºå¯¸');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€æ¬¡æµ‹è¯•
        window.addEventListener('load', () => {
            log('ğŸŒ Nano Bananaæµ‹è¯•å·¥å…·å·²åŠ è½½');
            log('ğŸ“‹ æ¨¡å‹ID: ' + MODEL_ID);
            log('ğŸ”§ å‡†å¤‡å¼€å§‹æµ‹è¯•...');
        });
    </script>
</body>
</html>