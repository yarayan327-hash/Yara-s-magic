<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana API 测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-600">Nano Banana API 测试</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">API 配置验证</h2>
            <div id="config-status" class="p-4 rounded">
                正在检查配置...
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">API 测试</h2>
            <div class="mb-4">
                <input type="text" id="test-message" placeholder="输入测试消息" class="w-full p-3 border rounded">
            </div>
            <button onclick="testAPI()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">测试 API</button>
            <div id="test-result" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">使用说明</h2>
            <ul class="list-disc pl-5 space-y-2">
                <li>确保已在主文件中配置正确的 API 密钥</li>
                <li>输入简单的测试消息（如"你好"）</li>
                <li>点击测试按钮验证 API 连接</li>
                <li>如果成功，可以打开完整应用使用</li>
            </ul>
        </div>
    </div>

    <script>
        // 检查配置
        function checkConfig() {
            const configDiv = document.getElementById('config-status');

            // 模拟检查 API 密钥格式
            const apiKey = "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";

            if (apiKey && apiKey.startsWith('sk-or-v1-')) {
                configDiv.className = "p-4 rounded bg-green-100 text-green-800";
                configDiv.innerHTML = `
                    <strong>✅ API 密钥格式正确</strong><br>
                    密钥类型: OpenRouter<br>
                    模型: Nano Banana (3B)
                `;
            } else {
                configDiv.className = "p-4 rounded bg-red-100 text-red-800";
                configDiv.innerHTML = `
                    <strong>❌ API 密钥配置有误</strong><br>
                    请检查 ai-workbench.html 中的 API 密钥配置
                `;
            }
        }

        // 测试 API
        async function testAPI() {
            const message = document.getElementById('test-message').value;
            const resultDiv = document.getElementById('test-result');

            if (!message) {
                alert('请输入测试消息');
                return;
            }

            resultDiv.className = "mt-4 p-4 rounded bg-blue-100 text-blue-800";
            resultDiv.innerHTML = '正在发送请求...';
            resultDiv.classList.remove('hidden');

            try {
                const API_KEY = "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";
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Nano Banana Test'
                    },
                    body: JSON.stringify({
                        model: 'google/gemini-2.5-flash-image-preview',
                        messages: [
                            { role: 'user', content: message }
                        ],
                        temperature: 0.7,
                        max_tokens: 200
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;

                resultDiv.className = "mt-4 p-4 rounded bg-green-100 text-green-800";
                resultDiv.innerHTML = `
                    <strong>✅ API 测试成功！</strong><br>
                    <strong>您的消息:</strong> ${message}<br>
                    <strong>AI 回复:</strong> ${reply}
                `;

            } catch (error) {
                resultDiv.className = "mt-4 p-4 rounded bg-red-100 text-red-800";
                resultDiv.innerHTML = `
                    <strong>❌ API 测试失败</strong><br>
                    错误信息: ${error.message}<br>
                    请检查 API 密钥和网络连接
                `;
            }
        }

        // 页面加载时检查配置
        checkConfig();
    </script>
</body>
</html>