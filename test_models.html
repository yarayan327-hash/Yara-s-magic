<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试不同AI模型的图像生成能力</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-purple-600">🧪 AI模型图像生成能力测试</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">测试配置</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">API密钥:</label>
                    <input type="text" id="api-key" value="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"
                           class="w-full p-3 border rounded font-mono text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">测试提示词:</label>
                    <input type="text" id="test-prompt" value="生成一只可爱的小猫，真实照片风格"
                           class="w-full p-3 border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">测试类型:</label>
                    <select id="test-type" class="w-full p-3 border rounded">
                        <option value="chinese">中文提示词</option>
                        <option value="english">英文提示词</option>
                        <option value="explicit">显式图像生成</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">要测试的AI模型</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Google Models -->
                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="google/gemini-2.5-flash-image-preview" checked>
                        <span>Gemini 2.5 Flash Image</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">Google最新多模态模型</p>
                </div>

                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="google/gemini-flash-1.5">
                        <span>Gemini Flash 1.5</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">Google快速多模态模型</p>
                </div>

                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="google/gemini-pro-vision">
                        <span>Gemini Pro Vision</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">Google视觉理解模型</p>
                </div>

                <!-- OpenAI Models -->
                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="openai/dall-e-3">
                        <span>DALL-E 3</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">OpenAI图像生成模型</p>
                </div>

                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="openai/gpt-4-vision-preview">
                        <span>GPT-4 Vision</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">OpenAI视觉理解模型</p>
                </div>

                <!-- Other Image Models -->
                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="stabilityai/stable-diffusion-xl-base-1.0">
                        <span>Stable Diffusion XL</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">StabilityAI图像生成模型</p>
                </div>

                <div class="p-4 border rounded-lg">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="model-checkbox" value="openrouter/dall-e-3">
                        <span>OpenRouter DALL-E 3</span>
                    </label>
                    <p class="text-sm text-gray-600 mt-1">OpenRouter提供的DALL-E 3</p>
                </div>
            </div>
        </div>

        <div class="text-center mb-6">
            <button onclick="startTesting()" class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 text-lg font-semibold">
                开始批量测试
            </button>
        </div>

        <div id="results" class="space-y-6">
            <!-- 测试结果将在这里显示 -->
        </div>
    </div>

    <script>
        function getSelectedModels() {
            return Array.from(document.querySelectorAll('.model-checkbox:checked'))
                       .map(cb => cb.value);
        }

        function getTestPrompt() {
            const type = document.getElementById('test-type').value;
            const basePrompt = document.getElementById('test-prompt').value;

            switch(type) {
                case 'chinese':
                    return basePrompt;
                case 'english':
                    return 'create a cute cat, photorealistic style';
                case 'explicit':
                    return 'generate image: a cute cat, photorealistic style';
                default:
                    return basePrompt;
            }
        }

        async function startTesting() {
            const models = getSelectedModels();
            const prompt = getTestPrompt();
            const apiKey = document.getElementById('api-key').value;

            if (models.length === 0) {
                alert('请至少选择一个模型');
                return;
            }

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <p class="text-blue-800">🔄 开始测试 ${models.length} 个模型，提示词: "${prompt}"</p>
                </div>
            `;

            for (const model of models) {
                await testModel(model, prompt, apiKey);
                await new Promise(resolve => setTimeout(resolve, 2000)); // 避免速率限制
            }

            resultsDiv.innerHTML += `<div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-green-800">✅ 所有模型测试完成！</p>
                </div>
            `;
        }

        async function testModel(model, prompt, apiKey) {
            const resultsDiv = document.getElementById('results');

            const resultDiv = document.createElement('div');
            resultDiv.className = 'bg-white rounded-lg shadow-lg p-6';
            resultDiv.innerHTML = `<h3 class="text-lg font-semibold mb-4 flex items-center">
                    <span class="animate-spin mr-2">🔄</span>
                    正在测试: ${model}
                </h3>
                <div class="text-gray-600">等待结果...</div>
            `;
            resultsDiv.appendChild(resultDiv);

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Model Test'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${JSON.stringify(data)}`);
                }

                const message = data.choices[0].message;
                const hasImages = message.images && message.images.length > 0;

                resultDiv.innerHTML = `
                    <h3 class="text-lg font-semibold mb-4 ${hasImages ? 'text-green-600' : 'text-orange-600'}">
                        ${hasImages ? '✅' : '⚠️'} ${model}
                    </h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-medium mb-2">响应内容:</h4>
                            <p class="text-sm bg-gray-100 p-3 rounded">${message.content}</p>
                        </div>
                        <div>
                            <h4 class="font-medium mb-2">图像信息:</h4>
                            ${hasImages ? `
                                <p class="text-sm text-green-600">✅ 生成 ${message.images.length} 张图像</p>
                                ${message.images.map((img, i) => `
                                    <div class="mt-2">
                                        <img src="${img.image_url.url}" alt="图像 ${i+1}" class="max-w-full h-auto rounded border">
                                        <p class="text-xs text-gray-500 mt-1">图像 ${i+1}: ${img.image_url.url.substring(0, 50)}...</p>
                                    </div>
                                `).join('')}
                            ` : `
                                <p class="text-sm text-orange-600">⚠️ 没有生成图像</p>
                                <p class="text-xs text-gray-500">此模型可能不支持图像生成，或提示词未触发图像生成功能</p>
                            `}
                        </div>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 class="text-lg font-semibold mb-4 text-red-600">❌ ${model}</h3>
                    <p class="text-red-600">错误: ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>