<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–APIæµ‹è¯• - Nano Banana</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold text-center mb-6 text-blue-600">ğŸ”§ ç®€åŒ–APIæµ‹è¯•å·¥å…·</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">æµ‹è¯•é…ç½®</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">APIå¯†é’¥:</label>
                    <input type="text" id="api-key" value="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"
                           class="w-full p-3 border rounded font-mono text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">æ¨¡å‹:</label>
                    <select id="model" class="w-full p-3 border rounded">
                        <option value="google/gemini-2.5-flash-preview-image">ğŸŒ Nano Banana (Gemini 2.5 Flash Image)</option>
                        <option value="google/gemini-flash-1.5">Gemini Flash 1.5</option>
                        <option value="openai/dall-e-3">DALL-E 3</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">æµ‹è¯•æç¤ºè¯</h2>
            <div class="space-y-4">
                <input type="text" id="prompt" placeholder="è¾“å…¥æµ‹è¯•æç¤ºè¯"
                       class="w-full p-3 border rounded" value="ä¸€åªå¯çˆ±çš„å°çŒ«">
                <div class="flex gap-2">
                    <button onclick="testBasic()" class="bg-blue-500 text-white px-4 py-2 rounded">åŸºç¡€æµ‹è¯•</button>
                    <button onclick="testWithImageKeyword()" class="bg-green-500 text-white px-4 py-2 rounded">å«å›¾åƒå…³é”®è¯</button>
                    <button onclick="testEnglish()" class="bg-purple-500 text-white px-4 py-2 rounded">è‹±æ–‡æµ‹è¯•</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-lg font-semibold mb-4">è¯·æ±‚è¯¦æƒ…</h2>
                <div id="request-details" class="p-4 bg-gray-100 rounded font-mono text-xs max-h-48 overflow-auto">
                    ç­‰å¾…æµ‹è¯•...
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-lg font-semibold mb-4">å“åº”è¯¦æƒ…</h2>
                <div id="response-details" class="p-4 bg-gray-100 rounded font-mono text-xs max-h-48 overflow-auto">
                    ç­‰å¾…å“åº”...
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <h2 class="text-lg font-semibold mb-4">æµ‹è¯•ç»“æœ</h2>
            <div id="test-results" class="p-4 border rounded min-h-32">
                <span class="text-gray-500">æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º</span>
            </div>
        </div>
    </div>

    <script>
        function testBasic() {
            testAPI('ä¸€åªå¯çˆ±çš„å°çŒ«');
        }

        function testWithImageKeyword() {
            testAPI('ç”Ÿæˆå›¾åƒï¼šä¸€åªå¯çˆ±çš„å°çŒ«ï¼ŒçœŸå®ç…§ç‰‡é£æ ¼');
        }

        function testEnglish() {
            testAPI('generate image: a cute cat, photorealistic style');
        }

        async function testAPI(prompt) {
            const apiKey = document.getElementById('api-key').value;
            const model = document.getElementById('model').value;

            // æ˜¾ç¤ºè¯·æ±‚è¯¦æƒ…
            const requestBody = {
                model: model,
                messages: [{
                    role: 'user',
                    content: prompt
                }],
                temperature: 0.7,
                max_tokens: 1000
            };

            document.getElementById('request-details').innerHTML = `
                <div class="text-sm">
                    <strong>æ¨¡å‹:</strong> ${model}<br>
                    <strong>æç¤ºè¯:</strong> ${prompt}<br>
                    <strong>å®Œæ•´è¯·æ±‚:</strong><br>
                    <pre class="mt-2 text-xs">${JSON.stringify(requestBody, null, 2)}</pre>
                </div>
            `;

            document.getElementById('response-details').innerHTML = 'ç­‰å¾…å“åº”...';
            document.getElementById('test-results').innerHTML = 'æµ‹è¯•ä¸­...';

            try {
                console.log('ğŸš€ å¼€å§‹APIæµ‹è¯•');
                console.log('ğŸ“‹ è¯·æ±‚æ•°æ®:', requestBody);

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Simple API Test'
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('ğŸ“Š å“åº”çŠ¶æ€:', response.status);
                console.log('ğŸ“Š å“åº”å¤´:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('âŒ é”™è¯¯å“åº”:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('ğŸ“¥ å®Œæ•´å“åº”:', JSON.stringify(data, null, 2));

                // æ˜¾ç¤ºå“åº”è¯¦æƒ…
                document.getElementById('response-details').innerHTML = `
                    <div class="text-sm">
                        <strong>HTTPçŠ¶æ€:</strong> ${response.status}<br>
                        <strong>å®Œæ•´å“åº”:</strong><br>
                        <pre class="mt-2 text-xs">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

                // åˆ†æå“åº”
                analyzeResponse(data, prompt);

            } catch (error) {
                console.error('âŒ æµ‹è¯•é”™è¯¯:', error);

                document.getElementById('response-details').innerHTML = `
                    <div class="text-red-600">
                        <strong>é”™è¯¯:</strong> ${error.message}<br>
                        <strong>å»ºè®®:</strong> æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥
                    </div>
                `;

                document.getElementById('test-results').innerHTML = `
                    <div class="text-red-500">
                        <p class="font-semibold">æµ‹è¯•å¤±è´¥</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
            }
        }

        function analyzeResponse(data, originalPrompt) {
            const resultsDiv = document.getElementById('test-results');

            try {
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    resultsDiv.innerHTML = `
                        <div class="text-red-500">
                            <p class="font-semibold">å“åº”æ ¼å¼æ— æ•ˆ</p>
                            <p class="text-sm">ç¼ºå°‘messageå­—æ®µ</p>
                        </div>
                    `;
                    return;
                }

                const message = data.choices[0].message;
                const hasImages = message.images && message.images.length > 0;

                let html = `
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold ${hasImages ? 'text-green-600' : 'text-orange-600'}">
                            ${hasImages ? 'âœ…' : 'âš ï¸'} æµ‹è¯•ç»“æœ
                        </h3>

                        <div>
                            <h4 class="font-medium">AIå›å¤:</h4>
                            <p class="text-sm bg-gray-100 p-3 rounded">${message.content}</p>
                        </div>
                `;

                if (hasImages) {
                    html += `
                        <div>
                            <h4 class="font-medium text-green-600">ğŸ‰ å›¾åƒç”ŸæˆæˆåŠŸï¼</h4>
                            <p class="text-sm">ç”Ÿæˆäº† ${message.images.length} å¼ å›¾åƒ</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"
                    `;

                    message.images.forEach((image, index) => {
                        if (image.image_url && image.image_url.url) {
                            html += `
                                <div class="border rounded p-2">
                                    <img src="${image.image_url.url}" alt="å›¾åƒ ${index + 1}" class="max-w-full h-auto rounded">
                                    <p class="text-xs text-gray-500 mt-1">å›¾åƒ ${index + 1}</p>
                                </div>
                            `;
                        }
                    });

                    html += '</div></div>';
                } else {
                    html += `
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                            <h4 class="font-medium text-yellow-800">âš ï¸ æ— å›¾åƒç”Ÿæˆ</h4>
                            <p class="text-sm text-yellow-700">æ­¤æ¨¡å‹å¯èƒ½ä¸æ”¯æŒå›¾åƒç”Ÿæˆï¼Œæˆ–æç¤ºè¯æœªè§¦å‘å›¾åƒåŠŸèƒ½</p>
                            <p class="text-xs text-yellow-600 mt-2">åŸå§‹æç¤ºè¯: "${originalPrompt}"</p>
                        </div>
                    `;
                }

                html += '</div>';
                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-red-500">
                        <p class="font-semibold">åˆ†æé”™è¯¯</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>